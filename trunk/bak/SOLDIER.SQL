

SELECT * FROM t_role ;
SELECT * FROM t_role_action ;
SELECT * FROM t_role_authority ;

select * from t_group;
select * from t_user;
SHOW CREATE TABLE t_user ;
select * from t_source;

update t_user set USER_NAME = 'CUS' WHERE USER_NAME = 'Tom' ;
DELETE FROM t_role_action  WHERE MENU_SEQ LIKE 'R%' ;
DELETE FROM t_role_authority WHERE MENU_SEQ LIKE 'R%' ;

--        t_role_action 

DELETE FROM t_role_action WHERE MENU_SEQ LIKE 'G%' OR MENU_SEQ LIKE 'M%' OR MENU_SEQ LIKE 'S%' ;
DELETE FROM t_role_action WHERE MENU_SEQ LIKE 'G%' ;

INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('S001', '(soldier.do)', '发兵', 1, NULL, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('S00101', '(soldier_source_add_display.do)', '添加发兵信息', 1, 'S001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('S00102', '(soldier_source_update_display.do)', '修改发兵信息', 2, 'S001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('S00103', '(soldier_source_query_display.do)', '查询发兵信息', 3, 'S001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('S00104', '(soldier_source_approve_display.do)', '审批发兵信息', 4, 'S001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('S00105', '(soldier_add_display.do)', '增加发兵兵种', 5, 'S001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('S00106', '(soldier_query_display.do)', '查询发兵兵种', 6, 'S001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;


    
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('S0010101', '(soldier_source_add.do)', '添加发兵信息', 1, 'S001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('S0010301', '(soldier_source_query.do)', '查询发兵信息', 1, 'S001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;


INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('M001', '(member.do)', '会员', 2, NULL, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('M00101', '(member_add_display.do)', '添加会员', 1, 'M001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('M00102', '(member_update_display.do)', '修改会员', 2, 'M001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('M00103', '(member_query_display.do)', '查询会员', 3, 'M001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;


INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('G001', '(gem.do)', '宝石', 3, NULL, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('G00101', '(gem_source_add_display.do)', '添加宝石', 1, 'G001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('G00102', '(gem_source_update_display.do)', '修改宝石', 2, 'G001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('G00103', '(gem_source_query_display.do)', '查询宝石', 3, 'G001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('G00104', '(gem_source_distribution_query_display.do)', '宝石发放', 4, 'G001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
    
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('G0010101', '(gem_source_add.do)', '添加宝石', 1, 'G001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('G0010301', '(gem_source_query.do)', '查询宝石', 1, 'G001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_action(MENU_SEQ, ROLE_ACTION_URL, ROLE_ACTION_NAME, DISPLAY_ORDER, PARENT_MENU_SEQ, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES('G0010401', '(gem_source_distribution_query.do)', '宝石发放', 1, 'G001', 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;


    
    
    
update t_role_action set DISPLAY_ORDER = 1 where MENU_SEQ='G00104' ;
DELETE FROM t_role_action where MENU_SEQ='G0010401' ;
SELECT * FROM t_role_action WHERE INSTR(ROLE_ACTION_URL,'gem_source_distribution_query') > 0 ;




   select
        roleaction0_.MENU_SEQ as MENU1_14_,
        roleaction0_.ROLE_ACTION_URL as ROLE2_14_,
        roleaction0_.ROLE_ACTION_NAME as ROLE3_14_,
        roleaction0_.DISPLAY_ORDER as DISPLAY4_14_,
        roleaction0_.PARENT_MENU_SEQ as PARENT5_14_,
        roleaction0_.UPDATE_STAFF_ID as UPDATE6_14_,
        roleaction0_.INPUT_STAFF_ID as INPUT7_14_,
        roleaction0_.ACTIVE_FLAG as ACTIVE8_14_,
        roleaction0_.INPUT_DATE as INPUT9_14_,
        roleaction0_.UPDATE_DATE as UPDATE10_14_ 
    from
        t_role_action roleaction0_ 
    where
        INSTR(roleaction0_.ROLE_ACTION_URL, 'gem_source_distribution_query.do')>0








-- t_role_authority

SELECT * FROM t_role_authority ;


INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'S001', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'S00101', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'S00102', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'S00103', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'S00104', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'S00105', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'S00106', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;


INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'M001', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'M00101', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'M00102', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'M00103', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;


INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'G001', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'G00101', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'G00102', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'G00103', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(1, 'G00104', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;




--==--==

INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(2, 'S001', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(2, 'S00101', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(2, 'S00102', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(2, 'S00103', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;

INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(2, 'G001', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(2, 'G00103', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;
INSERT INTO t_role_authority(ROLE_ID, MENU_SEQ, SELECTED_FLAG, UPDATE_STAFF_ID, INPUT_STAFF_ID, ACTIVE_FLAG, INPUT_DATE, UPDATE_DATE) 
    VALUES(2, 'G00104', 1, 'INIT', 'INIT', 1, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) ;





DROP TABLE IF EXISTS `t_soldier`;

CREATE TABLE `t_soldier` (
  `SOLDIER_ID` int(4) NOT NULL auto_increment,
  `SOLDIER_NAME` varchar(20) NOT NULL,
  `SOLDIER_POINT` decimal(10,0) NOT NULL,
  `INPUT_STAFF_ID` varchar(10) default NULL,
  `UPDATE_STAFF_ID` varchar(10) default NULL,
  `INPUT_DATE` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  `UPDATE_DATE` timestamp NOT NULL,
  `ACTIVE_FLAG` int(1) default '1',
  PRIMARY KEY  (`SOLDIER_ID`),
  UNIQUE KEY `SOLDIER_NAME` (`SOLDIER_NAME`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312;





SELECT * FROM t_soldier ;



INSERT INTO `t_soldier` (`SOLDIER_ID`, `SOLDIER_NAME`, `SOLDIER_POINT`, `UPDATE_STAFF_ID`, `INPUT_STAFF_ID`,`INPUT_DATE`, `UPDATE_DATE`, `ACTIVE_FLAG`) VALUES
  (1,'枪盾',1, 'INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1),
  (2,'大刀',3, 'INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1),
  (3,'骑兵',9, 'INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1),
  (4,'重甲',50, 'INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1);






SELECT * FROM t_soldier_source ;
SHOW CREATE TABLE t_soldier_source;
SELECT * FROM t_user ;

#
# Structure for the `t_soldier_source` table :
#

DROP TABLE IF EXISTS `t_soldier_source`;

CREATE TABLE `t_soldier_source` (
  `SOURCE_ID` varchar(50) NOT NULL,
  `USER_ID` int(10) NOT NULL,
  `SOURCE_SOLDIER_ID` int(10) NOT NULL,
  `SOURCE_SOLDIER_COUNT` int(10) NOT NULL default '0',
  `KINGDOM_ID` int(10) NOT NULL,
  `SOURCE_SOLDIER_SUM_POINT` decimal(10,2) NOT NULL default '0.00',
  `APPROVED`  int(1) NOT NULL,
  `SOURCE_DATE` varchar(8) NOT NULL,
  `INPUT_STAFF_ID` varchar(50) NOT NULL,
  `UPDATE_STAFF_ID` varchar(50) NOT NULL,
  `INPUT_DATE` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  `UPDATE_DATE` timestamp NOT NULL,
  `ACTIVE_FLAG` int(1) NOT NULL,
  PRIMARY KEY  (`SOURCE_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312;


SELECT * FROM t_soldier_source;


SELECT C.KINGDOM_ID,C.SOURCE_SOLDIER_ID,SUM(C.SOURCE_SOLDIER_COUNT),SUM(C.SOURCE_SOLDIER_COUNT)*S.SOLDIER_POINT SP FROM T_SOLDIER_SOURCE C LEFT JOIN T_SOLDIER S ON C.SOURCE_SOLDIER_ID = S.SOLDIER_ID 
				WHERE  C.SOURCE_DATE = '20120901' AND C.KINGDOM_ID = 5 GROUP BY C.KINGDOM_ID,C.SOURCE_SOLDIER_ID
SELECT C.KINGDOM_ID,C.SOURCE_SOLDIER_ID,SUM(C.SOURCE_SOLDIER_COUNT) SSC,SUM(C.SOURCE_SOLDIER_COUNT)*S.SOLDIER_POINT SP FROM T_SOLDIER_SOURCE C LEFT JOIN T_SOLDIER S ON C.SOURCE_SOLDIER_ID = S.SOLDIER_ID 
WHERE  C.SOURCE_DATE = '20120901' AND C.KINGDOM_ID=5 GROUP BY C.KINGDOM_ID,C.SOURCE_SOLDIER_ID 
			
-- 兵力总分


          SELECT
        C.KINGDOM_ID,
        K.KINGDOM_NAME,
        C.SOURCE_DATE ,
        U.USER_DISPLAY_NAME,
        C.USER_ID,
        C.SOURCE_SOLDIER_ID,
        SUM(C.SOURCE_SOLDIER_COUNT) SSC,
        SUM(C.SOURCE_SOLDIER_COUNT)*S.SOLDIER_POINT SP 
    FROM
        T_SOLDIER_SOURCE C 
    LEFT JOIN
        T_SOLDIER S        
            ON S.SOLDIER_ID =  C.SOURCE_SOLDIER_ID 
    LEFT JOIN
        T_KINGDOM K     
            ON K.KINGDOM_ID = C.KINGDOM_ID 
    LEFT JOIN
        T_USER U     
            ON U.USER_ID = C.USER_ID 
    WHERE
        C.SOURCE_DATE = '20120915'    
        AND C.KINGDOM_ID=1 
    GROUP BY
        C.KINGDOM_ID,
        C.USER_ID,
        C.SOURCE_SOLDIER_ID 
            

            
        --国家 日期 名字 枪盾 大刀 骑兵 重甲  产生宝石分  交基金后宝石分    
            

            
            
            
            
-- 宝石分


SELECT * FROM T_GEM;            
            
            
SELECT GS.KINGDOM_ID,GS.GEM_ID,GM.GEM_DISPLAY_NAME,GM.GEM_POINT, GS.SOURCE_GEM_COUNT,(GS.SOURCE_GEM_COUNT * GM.GEM_POINT),GS.SOURCE_GEM_DATE FROM T_GEM_SOURCE GS  
LEFT JOIN T_GEM GM ON GS.GEM_ID = GM.GEM_ID 
WHERE GS.KINGDOM_ID = 5 ORDER BY GS.KINGDOM_ID;
            
-- 查询日期显示


				
				
SELECT * FROM T_SOLDIER_SOURCE WHERE SOURCE_DATE = '20120901'


DROP TABLE IF EXISTS `t_kingdom`;

CREATE TABLE `t_kingdom` (
  `KINGDOM_ID` int(10) NOT NULL auto_increment,
  `KINGDOM_NAME` varchar(30) NOT NULL,
  `INPUT_STAFF_ID` varchar(50) NOT NULL,
  `UPDATE_STAFF_ID` varchar(50) NOT NULL,
  `INPUT_DATE` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  `UPDATE_DATE` timestamp NOT NULL,
  `ACTIVE_FLAG` int(1) NOT NULL,
  PRIMARY KEY  (`KINGDOM_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312;



INSERT INTO `t_kingdom` (`KINGDOM_ID`, `KINGDOM_NAME`, `INPUT_STAFF_ID`, `UPDATE_STAFF_ID`, `INPUT_DATE`,
`UPDATE_DATE`, `ACTIVE_FLAG`) VALUES
  (1,'齐国','INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1),
  (2,'楚国','INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1),
  (3,'燕国','INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1),
  (4,'韩国','INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1),
  (5,'赵国','INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1),
  (6,'魏国','INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1),
  (7,'秦国','INIT', 'INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1);


SELECT * FROM T_KINGDOM;

-- 修改 user 表

ALTER TABLE `t_user` ADD COLUMN USER_DISPLAY_NAME varchar(50) NOT NULL AFTER `USER_ROLE` ;
ALTER TABLE `t_user` ADD COLUMN USER_REG_IP varchar(20) NOT NULL AFTER `USER_DISPLAY_NAME` ;
ALTER TABLE `t_user` ADD COLUMN USER_LAST_LOGIN_IP varchar(20) NOT NULL AFTER `USER_DISPLAY_NAME` ;

UPDATE t_user SET USER_DISPLAY_NAME = '傅红雪' WHERE USER_ID = 1;
UPDATE t_user SET USER_DISPLAY_NAME = '李寻欢' WHERE USER_ID = 2;
UPDATE t_user SET USER_DISPLAY_NAME = '慕容细雨' WHERE USER_ID = 3;

ALTER TABLE `t_user` ADD UNIQUE (USER_NAME,USER_DISPLAY_NAME);  

SHOW CREATE TABLE  t_user ;


CREATE TABLE `t_user` (
  `USER_ID` int(10) NOT NULL AUTO_INCREMENT,
  `USER_NAME` varchar(30) NOT NULL,
  `USER_PASSWORD` varchar(30) NOT NULL,
  `USER_ROLE` int(10) DEFAULT NULL,
  `USER_DISPLAY_NAME` varchar(50) NOT NULL,
  `USER_LAST_LOGIN_IP` varchar(20) NOT NULL,
  `USER_REG_IP` varchar(20) NOT NULL,
  `USER_PHOTO` varchar(30) DEFAULT NULL,
  `USER_EMAIL` varchar(30) DEFAULT NULL,
  `USER_MSN` varchar(30) DEFAULT NULL,
  `USER_SKYPE` varchar(30) DEFAULT NULL,
  `ACCOUNT_NON_EXPIRED` int(4) NOT NULL DEFAULT '0',
  `ACCOUNT_NON_LOCKED` int(4) NOT NULL DEFAULT '0',
  `CREDENTIALS_NON_EXPIRED` int(4) NOT NULL DEFAULT '0',
  `INPUT_USER_ID` int(10) NOT NULL,
  `INPUT_DATETIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `UPDATE_USER_ID` int(10) DEFAULT NULL,
  `UPDATE_DATETIME` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  `DELETED_FLAG` int(1) NOT NULL,
  `USER_DESC` varchar(500) DEFAULT NULL,
  PRIMARY KEY (`USER_ID`),
  UNIQUE KEY `USER_NAME` (`USER_NAME`,`USER_DISPLAY_NAME`)
) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=gb2312









INSERT INTO `t_user` (`USER_ID`, `USER_NAME`, `USER_PASSWORD`, `USER_DISPLAY_NAME`,`USER_ROLE`, `USER_PHOTO`, `USER_EMAIL`, `USER_MSN`, `USER_SKYPE`, `ACCOUNT_NON_EXPIRED`, `ACCOUNT_NON_LOCKED`, `CREDENTIALS_NON_EXPIRED`, `INPUT_USER_ID`, `INPUT_DATETIME`, `UPDATE_USER_ID`, `UPDATE_DATETIME`, `DELETED_FLAG`, `USER_DESC`) VALUES
  (1,'Mary','1111','傅红雪',2,NULL,NULL,NULL,NULL,0,1,1,1,'2007-09-10 01:27:02',NULL,'2006-01-02 00:00:00',0,NULL),
  (2,'Tom','2222','李寻欢',3,NULL,NULL,NULL,NULL,1,1,1,2,'2007-05-17 21:10:50',NULL,'2006-02-02 00:00:00',0,NULL),
  (3,'MEI','3333','慕容细雨',1,NULL,NULL,NULL,NULL,1,1,1,3,'2008-05-18 22:18:27',NULL,'2006-01-02 00:00:00',0,NULL);
  (4,'W','3333','白起',2,NULL,NULL,NULL,NULL,1,1,1,3,'2008-05-18 22:18:27',NULL,'2006-01-02 00:00:00',0,NULL);

INSERT INTO `t_user` (`USER_ID`, `USER_NAME`, `USER_PASSWORD`, `USER_DISPLAY_NAME`,`USER_ROLE`, `USER_PHOTO`, `USER_EMAIL`, `USER_MSN`, `USER_SKYPE`, `ACCOUNT_NON_EXPIRED`, `ACCOUNT_NON_LOCKED`, `CREDENTIALS_NON_EXPIRED`, `INPUT_USER_ID`, `INPUT_DATETIME`, `UPDATE_USER_ID`, `UPDATE_DATETIME`, `DELETED_FLAG`, `USER_DESC`) 
values(4,'W','3333','白起',2,NULL,NULL,NULL,NULL,1,1,1,3,'2008-05-18 22:18:27',NULL,'2006-01-02 00:00:00',0,NULL);
INSERT INTO `t_user` ( `USER_NAME`, `USER_PASSWORD`, `USER_DISPLAY_NAME`,`USER_ROLE`, `USER_PHOTO`, `USER_EMAIL`, `USER_MSN`, `USER_SKYPE`, `ACCOUNT_NON_EXPIRED`, `ACCOUNT_NON_LOCKED`, `CREDENTIALS_NON_EXPIRED`, `INPUT_USER_ID`, `INPUT_DATETIME`, `UPDATE_USER_ID`, `UPDATE_DATETIME`, `DELETED_FLAG`, `USER_DESC`)
values( 'TEST','3333','测试号',2,NULL,NULL,NULL,NULL,1,1,1,3,'2008-05-18 22:18:27',NULL,'2006-01-02 00:00:00',0,NULL);

-- 修改 soldier_source 表
SELECT * FROM `t_user` FOR update;
SELECT MAX(USER_ID)+1 AS NEW_ID FROM `t_user` FOR update;
SELECT * FROM T_NO_GENERATOR;
UPDATE t_user SET USER_REG_IP = '10.18.28.94' WHERE USER_ID <5;
SELECT COUNT(*) FROM T_USER WHERE USER_REG_IP = '10.18.28.94'

DROP TABLE IF EXISTS `t_role`;

CREATE TABLE `t_role` (
  `ROLE_ID` int(4) NOT NULL auto_increment,
  `ROLE_NAME` varchar(150) default 'UNKNOWN',
  `INPUT_DATE` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  `UPDATE_DATE` timestamp NOT NULL default '0000-00-00 00:00:00',
  `DELETED_FLAG` int(4) NOT NULL default '0',
  PRIMARY KEY  (`ROLE_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312;

#
# Data for the `t_role` table  (LIMIT 0,500)
#

INSERT INTO `t_role` (`ROLE_ID`, `ROLE_NAME`, `INPUT_DATE`, `UPDATE_DATE`, `DELETED_FLAG`) VALUES
  (1,'系统管理员','2008-07-17 22:43:56','2007-04-22 00:00:09',0),
  (2,'会员','2007-04-22 22:44:13','2007-04-23 00:00:00',0),
  (3,'游客','2007-04-22 22:44:29','2007-04-19 00:00:00',0),
  (4,'未知用户','2007-06-06 00:00:00','2007-06-06 00:00:00',0);

SELECT * FROM `t_role`;



DROP TABLE IF EXISTS `t_no_generator`;

CREATE TABLE `t_no_generator` (
  `NO_TYPE` varchar(4) NOT NULL,
  `NO_COUNT` int(10) DEFAULT NULL,
  `ACTIVE_FLAG` int(1) DEFAULT NULL,
  `INPUT_DATE` timestamp NULL DEFAULT NULL,
  `UPDATE_DATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`NO_TYPE`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312 


SELECT * FROM t_no_generator ;
INSERT INTO `t_no_generator` VALUES
('LGIN',1,1,CURRENT_TIMESTAMP,CURRENT_TIMESTAMP);


show processlist;
UPDATE t_user SET ACCOUNT_NON_EXPIRED = 1 , ACCOUNT_NON_LOCKED = 1 ,CREDENTIALS_NON_EXPIRED =1 WHERE USER_NAME LIKE 'U%'
SELECT * FROM `t_user`;



show variables like 'collation_%';


DROP TABLE IF EXISTS `t_gem`;

CREATE TABLE `t_gem` (
  `GEM_ID` int(10) NOT NULL auto_increment,
  `GEM_DISPLAY_NAME` varchar(30) NOT NULL,
  `GEM_POINT` int(10) NOT NULL ,
  `INPUT_STAFF_ID` varchar(50) NOT NULL,
  `UPDATE_STAFF_ID` varchar(50) NOT NULL,
  `INPUT_DATE` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  `UPDATE_DATE` timestamp NOT NULL,
  `ACTIVE_FLAG` int(1) NOT NULL,
  PRIMARY KEY  (`GEM_ID`),
  UNIQUE KEY GEM_DISPLAY_NAME (`GEM_DISPLAY_NAME`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312;

INSERT INTO `t_gem` (GEM_ID,GEM_DISPLAY_NAME,GEM_POINT,INPUT_STAFF_ID,UPDATE_STAFF_ID,INPUT_DATE,UPDATE_DATE,ACTIVE_FLAG) 
VALUES(1,'2级负载宝石(绑)',1,'INIT','INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1);
INSERT INTO `t_gem` (GEM_ID,GEM_DISPLAY_NAME,GEM_POINT,INPUT_STAFF_ID,UPDATE_STAFF_ID,INPUT_DATE,UPDATE_DATE,ACTIVE_FLAG) 
VALUES(2,'2级疾风宝石(绑)',1,'INIT','INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1);
INSERT INTO `t_gem` (GEM_ID,GEM_DISPLAY_NAME,GEM_POINT,INPUT_STAFF_ID,UPDATE_STAFF_ID,INPUT_DATE,UPDATE_DATE,ACTIVE_FLAG) 
VALUES(3,'2级防御宝石(绑)',3,'INIT','INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1);
INSERT INTO `t_gem` (GEM_ID,GEM_DISPLAY_NAME,GEM_POINT,INPUT_STAFF_ID,UPDATE_STAFF_ID,INPUT_DATE,UPDATE_DATE,ACTIVE_FLAG) 
VALUES(4,'2级奔雷宝石(绑)',7,'INIT','INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1);
INSERT INTO `t_gem` (GEM_ID,GEM_DISPLAY_NAME,GEM_POINT,INPUT_STAFF_ID,UPDATE_STAFF_ID,INPUT_DATE,UPDATE_DATE,ACTIVE_FLAG) 
VALUES(5,'2级修罗宝石(绑)',7,'INIT','INIT',CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,1);

SELECT * FROM t_gem;


DROP TABLE IF EXISTS `t_syks_config`;

CREATE TABLE `t_sys_config` (
  `CONFIG_TYPE` varchar(50) NOT NULL,
  `CONFIG_KEY` varchar(50) NOT NULL,
  `CONFIG_VALUE` varchar(50) NOT NULL,
  `CONFIG_MEMO` varchar(100) NOT NULL,
  PRIMARY KEY  (`CONFIG_TYPE`,`CONFIG_KEY`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312;

INSERT INTO `t_sys_config` (CONFIG_TYPE,CONFIG_KEY,CONFIG_VALUE,CONFIG_MEMO) 
VALUES('GEM','FAMILY_FOUNDATION','20','');

INSERT INTO `t_sys_config` (CONFIG_TYPE,CONFIG_KEY,CONFIG_VALUE,CONFIG_MEMO) 
VALUES('SYS','OPEN_SWITCH','1','0#CLOSE,1#OPEN');


SELECT * FROM T_SYS_CONFIG;


DROP TABLE IF EXISTS `t_gem_source`;

CREATE TABLE `t_gem_source` (
  `GEM_SOURCE_ID` varchar(50) NOT NULL,
  `KINGDOM_ID` int(10) NOT NULL,
  `GEM_ID` int(10) NOT NULL ,
  `SOURCE_GEM_COUNT` int(10) NOT NULL default '0',
  `SOURCE_GEM_DATE` varchar(8) NOT NULL,
  `INPUT_STAFF_ID` varchar(50) NOT NULL,
  `UPDATE_STAFF_ID` varchar(50) NOT NULL,
  `INPUT_DATE` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  `UPDATE_DATE` timestamp NOT NULL,
  `ACTIVE_FLAG` int(1) NOT NULL,
  PRIMARY KEY  (`GEM_SOURCE_ID`),
  UNIQUE KEY GEM_SOURCE (`KINGDOM_ID`,`GEM_ID`,`SOURCE_GEM_DATE`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312;



SELECT * FROM t_gem_source;
SELECT DISTINCT (SOURCE_GEM_DATE) FROM t_gem_source;

SELECT GEM_ID,SUM(SOURCE_GEM_COUNT) from t_gem_source  where ACTIVE_FLAG = 1 AND SOURCE_GEM_DATE='20120908' GROUP BY GEM_ID  ;

SELECT T_K.KINGDOM_NAME,T_S.GEM_ID,T_S.SOURCE_GEM_COUNT FROM t_gem_source t_s left join t_kingdom t_k  on t_s.KINGDOM_ID = t_k.KINGDOM_ID  WHERE t_s.SOURCE_GEM_DATE = '20120908' ORDER BY T_K.KINGDOM_NAME;



-- 查询  gem source total point

SELECT SUM(SC), SUM(T.GP) TOTAL_POINT FROM (
SELECT S.KINGDOM_ID,S.GEM_ID,SUM(S.SOURCE_GEM_COUNT) SC,SUM(S.SOURCE_GEM_COUNT)* G.GEM_POINT GP FROM T_GEM_SOURCE S LEFT JOIN T_GEM G ON S.GEM_ID=G.GEM_ID WHERE S.SOURCE_GEM_DATE = '20120908' GROUP BY S.KINGDOM_ID,S.GEM_ID
) AS T;

SELECT X.KINGDOM_ID,K.KINGDOM_NAME ,X.GEM_ID ,X.SC ,X.GP,X.SOURCE_GEM_DATE FROM 
(SELECT S.KINGDOM_ID,S.GEM_ID,SUM(S.SOURCE_GEM_COUNT) SC,SUM(S.SOURCE_GEM_COUNT)* G.GEM_POINT GP ,S.SOURCE_GEM_DATE FROM T_GEM_SOURCE S LEFT JOIN T_GEM G ON S.GEM_ID=G.GEM_ID WHERE S.SOURCE_GEM_DATE = '20120915' GROUP BY S.KINGDOM_ID,S.GEM_ID) AS X 
LEFT JOIN T_KINGDOM K ON K.KINGDOM_ID =  X.KINGDOM_ID ;



-- 查询  soldier source total point
SELECT SUM(T.SP) TOTAL FROM (
SELECT C.KINGDOM_ID,C.SOURCE_SOLDIER_ID,SUM(C.SOURCE_SOLDIER_COUNT),SUM(C.SOURCE_SOLDIER_COUNT)*S.SOLDIER_POINT SP FROM T_SOLDIER_SOURCE C LEFT JOIN T_SOLDIER S ON C.SOURCE_SOLDIER_ID = S.SOLDIER_ID WHERE  C.SOURCE_DATE = '20120901' GROUP BY C.KINGDOM_ID,C.SOURCE_SOLDIER_ID 
) AS T ;


SELECT C.KINGDOM_ID,
C.SOURCE_SOLDIER_ID,
SUM(C.SOURCE_SOLDIER_COUNT),
SUM(C.SOURCE_SOLDIER_COUNT)*S.SOLDIER_POINT SP 
FROM T_SOLDIER_SOURCE C 
	LEFT JOIN T_SOLDIER S ON C.SOURCE_SOLDIER_ID = S.SOLDIER_ID 
	WHERE  C.SOURCE_DATE = '20120901' GROUP BY C.KINGDOM_ID,C.SOURCE_SOLDIER_ID


	
	
	
SELECT
            C.KINGDOM_ID,
            C.SOURCE_SOLDIER_ID,
            SUM(C.SOURCE_SOLDIER_COUNT) SSC,
            SUM(C.SOURCE_SOLDIER_COUNT)*S.SOLDIER_POINT SP 
        FROM
            T_SOLDIER_SOURCE C 
        LEFT JOIN
            T_SOLDIER S 
                ON C.SOURCE_SOLDIER_ID = S.SOLDIER_ID 
        WHERE
            C.SOURCE_DATE = '20120915' 
            AND C.KINGDOM_ID=1 
        GROUP BY
            C.KINGDOM_ID,
            C.SOURCE_SOLDIER_ID	
	
	
	
	
show processlist;
	
	
	


SELECT * FROM t_soldier;

SELECT * FROM T_KINGDOM;

SELECT * FROM T_SYS_CONFIG ;
UPDATE T_SYS_CONFIG SET CONFIG_VALUE = 30 WHERE CONFIG_TYPE='GEM' AND CONFIG_KEY='FAMILY_FOUNDATION'
